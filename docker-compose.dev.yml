version: "3.8"

services:
    discord-bot-dev:
        build:
            context: .
            dockerfile: Dockerfile.dev
        container_name: discord-bot-dev
        restart: unless-stopped
        environment:
            - NODE_ENV=development
            - DISCORD_TOKEN=${DISCORD_TOKEN}
            - CLIENT_ID=${CLIENT_ID}
            - COMMANDS_DISABLED=${COMMANDS_DISABLED:-}
            - COMMAND_CATEGORIES_DISABLED=${COMMAND_CATEGORIES_DISABLED:-}
            - SENTRY_DSN=${SENTRY_DSN:-}
        volumes:
            - .:/app
            - /app/node_modules
            - ./downloads:/app/downloads
            - ./logs:/app/logs
        networks:
            - discord-bot-network
        healthcheck:
            test: ["CMD", "node", "-e", "console.log('Bot is running')"]
            interval: 30s
            timeout: 10s
            retries: 3
            start_period: 40s
        logging:
            driver: "json-file"
            options:
                max-size: "10m"
                max-file: "3"

networks:
    discord-bot-network:
        driver: bridge
